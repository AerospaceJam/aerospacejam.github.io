"use strict";(self.webpackChunkaerospace_jam=self.webpackChunkaerospace_jam||[]).push([[8724],{4183:(e,i,n)=>{n.r(i),n.d(i,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"challenges/lidar/lidar","title":"LiDAR (TF-Luna)","description":"","source":"@site/docs/challenges/lidar/lidar.md","sourceDirName":"challenges/lidar","slug":"/challenges/lidar/","permalink":"/challenges/lidar/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"description":""},"sidebar":"tutorialSidebar","previous":{"title":"IR Transmitter (KY-005)","permalink":"/challenges/ir/"},"next":{"title":"RFID (RC522)","permalink":"/challenges/rfid/"}}');var r=n(4848),t=n(8453);const s={sidebar_position:3,description:""},d="LiDAR (TF-Luna)",l={},c=[{value:"Wiring",id:"wiring",level:2},{value:"Code",id:"code",level:2},{value:"Further Reading",id:"further-reading",level:2}];function o(e){const i={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.header,{children:(0,r.jsx)(i.h1,{id:"lidar-tf-luna",children:"LiDAR (TF-Luna)"})}),"\n",(0,r.jsx)(i.h2,{id:"wiring",children:"Wiring"}),"\n",(0,r.jsx)(i.admonition,{type:"tip",children:(0,r.jsxs)(i.p,{children:["Source files for this diagram are available ",(0,r.jsx)(i.a,{href:"https://github.com/AerospaceJam/aerospacejam.github.io/blob/main/docs/challenges/lidar/lidar.fzz",children:"here"})]})}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Wiring diagram",src:n(8866).A+"",width:"1251",height:"633"})}),"\n",(0,r.jsx)(i.p,{children:"In case the above image is unclear, here's an additional schematic of the wiring as to prevent confusion:"}),"\n",(0,r.jsx)(i.p,{children:(0,r.jsx)(i.img,{alt:"Wiring schematic",src:n(8716).A+"",width:"651",height:"714"})}),"\n",(0,r.jsx)(i.h2,{id:"code",children:"Code"}),"\n",(0,r.jsx)(i.pre,{children:(0,r.jsx)(i.code,{className:"language-py",children:'from machine import UART, Pin\nimport utime\nfrom binascii import hexlify\n\nlidar = UART(0, baudrate=115200, tx=Pin(16), rx=Pin(17))\n\ndef save_settings() -> None:\n    """Saves the current settings to the Lidar."""\n    global lidar\n    lidar.write(bytes([0x5a, 0x04, 0x11, 0x6F]))\n    utime.sleep_ms(100)\n\ndef set_samp_rate(samp_rate: int = 20) -> None:\n    """\n    Sets the sampling rate of the Lidar.\n\n    Parameters:\n    - samp_rate: The desired sampling rate in Hz.\n    """\n    global lidar\n    hex_rate = samp_rate.to_bytes(2, \'big\')\n    samp_rate_packet = [0x5a, 0x06, 0x03, hex_rate[1], hex_rate[0], 0x00, 0x00]\n    lidar.write(bytes(samp_rate_packet))\n    utime.sleep(0.1)\n    save_settings()\n\ndef get_version() -> str:\n    """\n    Retrieves the Lidar version information.\n\n    Returns:\n    - A string representing the Lidar version.\n\n    Raises:\n    - RuntimeError: If the version retrieval fails.\n    """\n    global lidar\n    info_packet = [0x5a, 0x04, 0x14, 0x00]\n    lidar.write(bytes(info_packet))\n    start_tick = utime.time()\n    while utime.time() - start_tick < 10:\n        if lidar.any() > 0:\n            bin_ascii = lidar.read(30)\n            if bin_ascii and bin_ascii[0] == 0x5a:\n                version = bin_ascii[0:].decode(\'utf-8\')\n                return version\n            else:\n                lidar.write(bytes(info_packet))\n    raise RuntimeError("Failed to retrieve version.")\n\ndef get_lidar_data() -> tuple:\n    """\n    Retrieves the Lidar distance, strength, and temperature data.\n\n    Returns:\n    - A tuple (distance, strength, temperature) with the corresponding values.\n\n    Raises:\n    - RuntimeError: If data retrieval fails.\n    """\n    global lidar\n    while True:\n        if lidar.any() > 0:\n            bin_ascii = lidar.read(9)\n            if bin_ascii and len(bin_ascii) == 9 and bin_ascii[0] == 0x59 and bin_ascii[1] == 0x59:\n                distance = bin_ascii[2] + bin_ascii[3] * 256\n                strength = bin_ascii[4] + bin_ascii[5] * 256\n                temperature = (bin_ascii[6] + bin_ascii[7] * 256) / 8 - 256\n                return distance, strength, temperature\n        utime.sleep_ms(10)\n\n# ----- Example usage -----\n# version = get_version()\n# print(version)\n# set_samp_rate(20)\n# while True:\n#     try:\n#         distance, strength, temperature = get_lidar_data()\n#         print(f"Distance: {distance}, Strength: {strength}, Temperature: {temperature:.2f}")\n#     except RuntimeError as e:\n#         print(e)\n'})}),"\n",(0,r.jsx)(i.h2,{id:"further-reading",children:"Further Reading"}),"\n",(0,r.jsxs)(i.ul,{children:["\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://en.benewake.com/DataDownload/index.aspx?pid=20&lcid=21",children:"https://en.benewake.com/DataDownload/index.aspx?pid=20&lcid=21"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://forums.raspberrypi.com/viewtopic.php?t=340841",children:"https://forums.raspberrypi.com/viewtopic.php?t=340841"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://files.seeedstudio.com/wiki/Grove-TF_Mini_LiDAR/res/SJ-PM-TF-Luna-A03-Product-Manual.pdf",children:"https://files.seeedstudio.com/wiki/Grove-TF_Mini_LiDAR/res/SJ-PM-TF-Luna-A03-Product-Manual.pdf"})}),"\n",(0,r.jsx)(i.li,{children:(0,r.jsx)(i.a,{href:"https://www.waveshare.com/wiki/TF-Luna_LiDAR_Range_Sensor",children:"https://www.waveshare.com/wiki/TF-Luna_LiDAR_Range_Sensor"})}),"\n"]})]})}function h(e={}){const{wrapper:i}={...(0,t.R)(),...e.components};return i?(0,r.jsx)(i,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8866:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/lidar_bb-982b4d7cdc0950414a89976dc422b230.png"},8716:(e,i,n)=>{n.d(i,{A:()=>a});const a=n.p+"assets/images/lidar_schem-ef7c7c7407aa04502996f98e95a1d06d.png"},8453:(e,i,n)=>{n.d(i,{R:()=>s,x:()=>d});var a=n(6540);const r={},t=a.createContext(r);function s(e){const i=a.useContext(t);return a.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function d(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),a.createElement(t.Provider,{value:i},e.children)}}}]);