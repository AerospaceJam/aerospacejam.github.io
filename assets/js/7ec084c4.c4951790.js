"use strict";(self.webpackChunkaerospace_jam=self.webpackChunkaerospace_jam||[]).push([[6227],{4643:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"getting-started/adding-a-route/adding-a-route","title":"Adding a Route","description":"We have sensors reporting data to our WebUI, but now we need to be able to send data from the WebUI back to the Pico.","source":"@site/docs/getting-started/adding-a-route/adding-a-route.md","sourceDirName":"getting-started/adding-a-route","slug":"/getting-started/adding-a-route/","permalink":"/getting-started/adding-a-route/","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"description":"We have sensors reporting data to our WebUI, but now we need to be able to send data from the WebUI back to the Pico."},"sidebar":"tutorialSidebar","previous":{"title":"Adding a Sensor","permalink":"/getting-started/adding-a-sensor/"},"next":{"title":"Appendix","permalink":"/getting-started/appendix/"}}');var s=n(4848),a=n(8453);const r={sidebar_position:7,description:"We have sensors reporting data to our WebUI, but now we need to be able to send data from the WebUI back to the Pico."},i="Adding a Route",d={},c=[];function l(e){const t={code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"adding-a-route",children:"Adding a Route"})}),"\n",(0,s.jsx)(t.p,{children:"Now that we've gotten our sensors up and running, we need to be able to send data from the WebUI back to the Pico. To do so, we can add a custom HTTP path, which calls a function on your Pico when it is called and can return some custom data to the WebUI. You can add a route to the server with:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-py",children:'from aerospacejam import AerospaceJamServer, response_html, response_json\nimport json\n# ...trimmed for brevity\npico_server = AerospaceJamServer(WIFI_CONFIG)\n# ...trimmed for brevity\n\ndef hello_handler(request):\n    print("Someone said hello!")\n    return response_html("<h1>Hello, world!</h1>")\npico_server.register_path(\'/hello\', hello_handler)\n'})}),"\n",(0,s.jsxs)(t.p,{children:["Then, when you go to the Pico's static IP (by default, ",(0,s.jsx)(t.code,{children:"192.168.4.1"}),"), you can get the response from this from ",(0,s.jsx)(t.code,{children:"http://192.168.4.1/hello"}),". It will also log to the ",(0,s.jsx)(t.code,{children:"Shell"})," window in Thonny:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-txt",children:"Got a request from ('192.168.4.16', 53165)\nSomeone said hello!\n"})}),"\n",(0,s.jsx)(t.p,{children:"Note that this is actually causing code on the Pico to be executed as it recieves the request - so we can change this to do certain things when you were to, say, click a button. In the WebUI's HTML, if you were to add:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-html",children:'<script>\n    function send_message() {\n        fetch("/message", {\n            method: "post",\n            headers: {\n                \'Accept\': \'application/json\',\n                \'Content-Type\': \'application/json\'\n            },\n\n            body: JSON.stringify({\n                message: "Hello, world!"\n            })\n        })\n        .then( (response) => { \n            console.log("Sent!");\n        });\n    }\n<\/script>\n<button onclick="send_message()">Send Message To Pico</button>\n'})}),"\n",(0,s.jsxs)(t.p,{children:["When the button is clicked, it will send a request to ",(0,s.jsx)(t.code,{children:"/message"})," on the Pico. If you were to add the following handler code to the Pico:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-py",children:"# First, define a function for the handler itself\ndef message_handler(request):\n    # Then, convert the JSON's text to an actual Python object\n    data = json.loads(request.body)\n    # Then, we can do whatever we want with the object. For instance, since we defined the key `message: \"Hello, world!\"` in the WebUI's JavaScript,\n    # we can access it with data['message']:\n    print(\"Recieved a message:\")\n    print(data['message'])\n    # Now, we have to return a response of some kind. Since there's no real response to return, we can just return a JSON object saying that the\n    # request was a success.\n    return response_json({\"status\": \"OK\"})\n# And finally, we register this function as a message handler.\npico_server.register_path('/message', message_handler)\n"})})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>i});var o=n(6540);const s={},a=o.createContext(s);function r(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),o.createElement(a.Provider,{value:t},e.children)}}}]);